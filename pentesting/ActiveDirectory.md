---
layout: default
title: Active Directory
nav_order: 2
has_children: false
parent: Pentesting
grand_parent: DylanGrl Writings
---

## Active Directory

### Introduction 

- Directory service developped by Microsoft to manage Windows domain networks
- Store information related to objects (Computers, Users, Printers)
- Authenticate via Kerberos ticket or via RADIUS / LDAP for Linux and other non Windows device
- Could be exploit by abusing feature / trust built in the AD architecture

### Physical components

#### Domain Controllers :

A Domain Controller is a server with the AD DS server role nstalled that has specifically been promoted to a domain controller. It is the main target in an internal pentest. 

Details:

- Host the AD Directory Store (DS).
- Provide the authentication.
- Replicate updates to other domain controllers in the domain and forest.
- Allows administrative access to manage users accounts and network resources.

#### Active Directory Data Store (DS)

The AD DS data store contains the database files and processes that store and manage directory information for users, services, and application (User / Password)/

Details : 

- Consists of the Ntds.dit files (containing the information regarding user / password).
- It is stored by default in the `%SystemRoot%\NTDS` folder on all domain controllers.
- It is accessible only via the domain controller processes and protocols.


### Logical components 

#### AD DS Schema

Details : 
- It defines every type of object that can be stored in the directory.
- Enforces rules regarding object creation and configuration. 
	- Class Object : Type of object that can be create in the directory (ex: User, Computer)
	- Attribute Object : Information that can be attached to an object (ex: Display name)


#### Domains

Domains are used to group and manage objects in an organization

Details:
- An administratrive boundary for applying policies to groups of objects.
- A replication boundary for replicating data between domain controllers.
- An authentication and Authorization boundary that provides a way to limit te scope of access to resources.

#### Trees

Correspond to a group of domain, a hierachy of domains in AD DS. (example: domain.com - one.domain.com - two.domain.com)

Details:
- Share a contifous namespace with the parent domain.
- Can have additional child domains.
- By default create a two-way transitive trust with other domains.

#### Forests

Correspond to a collection of one or more domain trees.

Details:
- Share a common schema.
- Share a common configuration partition.
- Share a common global catalog to enable searching.
- Enable trusts between all domains in the forest.
- Share the Enterprise Admins and Schema Admins groups.


#### Organizational Units (OUs)

OUs are Active Directory containers that can contain users, groups, computers, and other OUs.

Details:
- Represnet your organization hierarchically and logically.
- Manage collection of objects in consistent way.
- Delegate permissions to administer groups of objects.
- Apply policies.



#### Trusts

Trusts provide a mechanism for users to gain access to resources in another domain.

Detail : 
- All domain in a forest trus all other domains in the forest
	- Directional, the trust direction flows from trusting domain to the trusted domain.
- Trusts can extend outside the forest 
	- Transitive, the trust relationship is extended beyon a two-domain trust to include other trusted domain.

#### Objects 

There are multiple objects : 

- User - Enables network resource access for a user.
- InetOrgPerson - Similar to a user account, Used for compatibility with other directory services.
- Contacts - Used primarly to assign e-mail to external users, Does not enable network access.
- Groups - Used to simplify the administration of Access Control.
- Computers - Enables authentication and auditing of computer access to resources.
- Printers - Used to simplify the process of location and connecting to printers.
- Shared folder - Enables users to search for shared folders based on properties.